<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redmine Â∞àÊ°àÊà∞ÊÉÖÂÆ§ (Á©©ÂÆöÈÄ£Á∑öÁâà)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin 2s linear infinite; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // --- Helper Functions ---
        const isToday = (dateString) => {
            if (!dateString) return false;
            const today = new Date();
            const date = new Date(dateString);
            return date.getDate() === today.getDate() &&
                date.getMonth() === today.getMonth() &&
                date.getFullYear() === today.getFullYear();
        };

        const isPast = (dateString) => {
            if (!dateString) return false;
            const today = new Date();
            today.setHours(0, 0, 0, 0); 
            const date = new Date(dateString);
            return date < today;
        };

        // Helper: Check if status is closed
        const isClosed = (statusName) => {
            if (!statusName) return false;
            const s = statusName.toLowerCase();
            return s === 'closed' || s === 'resolved' || s === 'rejected' || s.includes('Â∑≤Ëß£Ê±∫') || s.includes('ÁµêÊ°à') || s.includes('ÈóúÈñâ') || s.includes('ÂÆåÊàê');
        };

        const getBaseUrl = (inputUrl) => {
            try {
                const urlObj = new URL(inputUrl);
                return urlObj.origin; 
            } catch (e) {
                return inputUrl.replace(/\/$/, '');
            }
        };

        const getStatusColor = (status) => {
            const s = status.toLowerCase();
            if (s === 'new' || s === 'Êñ∞Âª∫') return 'bg-blue-100 text-blue-800 border-blue-200';
            if (s.includes('progress') || s.includes('ÈÄ≤Ë°å')) return 'bg-yellow-100 text-yellow-800 border-yellow-200';
            if (s === 'closed' || s === 'resolved' || s.includes('Â∑≤Ëß£Ê±∫') || s.includes('ÁµêÊ°à') || s.includes('ÈóúÈñâ')) return 'bg-slate-100 text-slate-500 border-slate-200';
            if (s === 'feedback' || s.includes('ÂõûÈ•ã')) return 'bg-purple-100 text-purple-800 border-purple-200';
            return 'bg-slate-50 text-slate-700 border-slate-200';
        };

        // --- Icons ---
        const Icon = ({ d, className, color }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={{ color }}>
                {d}
            </svg>
        );
        const Icons = {
            Activity: <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>,
            Alert: <><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></>,
            Clock: <><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>,
            User: <><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>,
            Settings: <><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></>,
            Search: <><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></>,
            List: <><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></>,
            CheckCircle: <><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>,
            Info: <><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></>,
            Refresh: <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
        };

        const Main = () => {
            // --- State ---
            const safeGet = (k, d) => localStorage.getItem(k) || d;
            
            const [config, setConfig] = useState({
                url: safeGet('redmine_url', 'https://igs.redmine-x.com'),
                apiKey: safeGet('redmine_apiKey', ''),
                projectId: safeGet('redmine_projectId', '')
            });
            const [proxyMode, setProxyMode] = useState(safeGet('redmine_proxyMode', 'public'));
            const [showSettings, setShowSettings] = useState(false);
            const [issues, setIssues] = useState([]);
            const [currentUser, setCurrentUser] = useState(null);
            
            // New State for User Filtering
            const [selectedUserId, setSelectedUserId] = useState('me'); 
            const [availableUsers, setAvailableUsers] = useState([]);

            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [statusMsg, setStatusMsg] = useState('');
            
            // UI Filters: 'all' (open), 'today', 'overdue', 'closed'
            const [filterType, setFilterType] = useState('all'); 

            // --- Effects ---
            useEffect(() => {
                localStorage.setItem('redmine_url', config.url);
                localStorage.setItem('redmine_apiKey', config.apiKey);
                localStorage.setItem('redmine_projectId', config.projectId);
                localStorage.setItem('redmine_proxyMode', proxyMode);
            }, [config, proxyMode]);

            // --- Fetch Logic (Enhanced Resilience) ---
            const fetchData = async () => {
                if (!config.apiKey) { setError({ title: 'Áº∫Â∞ëË≥áÊñô', msg: 'Ë´ãÂÖàËº∏ÂÖ• API Token' }); return; }
                setLoading(true); 
                setError(null);
                setStatusMsg('Ê∫ñÂÇôÈÄ£Á∑ö...');

                const cleanUrl = config.url.replace(/\/$/, '');

                // Define Proxy Providers for Rotation
                const proxyProviders = proxyMode === 'direct' 
                    ? [{ name: 'Direct', fn: (url) => url }] 
                    : [
                        { name: 'AllOrigins', fn: (url) => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}` },
                        { name: 'CorsProxy.io', fn: (url) => `https://corsproxy.io/?${encodeURIComponent(url)}` },
                        { name: 'CodeTabs', fn: (url) => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}` }
                    ];

                // Generic Fetcher with Retry
                const fetchWithRetry = async (apiPath) => {
                    let targetUrl = `${cleanUrl}${apiPath}`;
                    
                    // Critical Fix: For proxies, we MUST include the key in the target URL itself before encoding
                    // because most proxies won't forward custom headers or query params appended outside.
                    if (proxyMode !== 'direct') {
                        const separator = targetUrl.includes('?') ? '&' : '?';
                        targetUrl = `${targetUrl}${separator}key=${config.apiKey}`;
                    }

                    let lastErr = null;

                    for (const provider of proxyProviders) {
                        try {
                            setStatusMsg(`ÂòóË©¶ÈÄ£Á∑ö‰∏≠ (${provider.name})...`);
                            
                            // Generate the proxy URL with the already-authenticated target URL
                            const finalUrl = provider.fn(targetUrl);
                            
                            // Add headers only for Direct mode to avoid CORS preflight issues on some proxies
                            // For proxies, the key is already in the targetUrl above
                            const options = proxyMode === 'direct' 
                                ? { headers: { 'X-Redmine-API-Key': config.apiKey } } 
                                : {};

                            const res = await fetch(finalUrl, options);
                            
                            if (res.ok) {
                                return await res.json();
                            }
                            
                            if (res.status === 401) throw new Error('AUTH_401');
                            if (res.status === 404) throw new Error('URL_404');
                            throw new Error(`HTTP_${res.status}`);

                        } catch (err) {
                            console.warn(`Provider ${provider.name} failed:`, err);
                            lastErr = err;
                            // If it's an Auth/404 error, don't retry other proxies, it's a config issue
                            if (err.message === 'AUTH_401' || err.message === 'URL_404') throw err;
                        }
                    }
                    throw lastErr || new Error('ALL_PROXIES_FAILED');
                };

                try {
                    // 1. Fetch User
                    const userData = await fetchWithRetry('/users/current.json');
                    
                    // 2. Fetch Issues
                    // Update: Increase limit to 500 and sort by updated_on to ensure recent closed issues appear
                    const issuesData = await fetchWithRetry('/issues.json?limit=500&status_id=*&sort=updated_on:desc');

                    // 3. Update State
                    setCurrentUser(userData.user);
                    setIssues(issuesData.issues);

                    // Extract unique users
                    const usersMap = new Map();
                    if(userData.user) usersMap.set(userData.user.id, userData.user.firstname + ' ' + userData.user.lastname);
                    issuesData.issues.forEach(issue => {
                        if (issue.assigned_to) usersMap.set(issue.assigned_to.id, issue.assigned_to.name);
                    });
                    setAvailableUsers(Array.from(usersMap, ([id, name]) => ({ id, name })));
                    
                    // Default to current user if not set
                    if (selectedUserId === 'me' || !availableUsers.find(u => u.id == selectedUserId)) {
                        setSelectedUserId(userData.user.id);
                    }

                    setStatusMsg('');
                } catch (err) {
                    console.error("Fetch Error:", err);
                    let errorMsg = { title: 'ÈÄ£Á∑öÂ§±Êïó', msg: err.message, hint: '' };

                    if (err.message === 'AUTH_401') {
                        errorMsg = { title: 'Ê¨äÈôêÈåØË™§ (401)', msg: 'API Token ÁÑ°Êïà„ÄÇ', hint: 'Ë´ãÊ™¢Êü• Token ÊòØÂê¶Ê≠£Á¢∫„ÄÇ' };
                    } else if (err.message === 'URL_404') {
                        errorMsg = { title: 'Á∂≤ÂùÄÈåØË™§ (404)', msg: 'Êâæ‰∏çÂà∞ Redmine ‰∏ªÊ©ü„ÄÇ', hint: 'Ë´ãÊ™¢Êü•Á∂≤ÂùÄËº∏ÂÖ•ÊòØÂê¶ÊúâË™§„ÄÇ' };
                    } else if (err.message === 'ALL_PROXIES_FAILED' || err.message.includes('Failed to fetch')) {
                        errorMsg = { 
                            title: 'ÁÑ°Ê≥ïÂª∫Á´ãÈÄ£Á∑ö', 
                            msg: 'ÊâÄÊúâ‰ª£ÁêÜ‰º∫ÊúçÂô®ÁöÜÁÑ°Ê≥ïÂ≠òÂèñÊÇ®ÁöÑ Redmine„ÄÇ', 
                            hint: 'Ëã•ÊÇ®Âú®ÂÖ¨Âè∏ÂÖßÁ∂≤ÔºåË´ãÂàáÊèõÁÇ∫„ÄåÁõ¥ÈÄ£Ê®°Âºè„Äç‰∏¶ÂÆâË£ù Allow CORS Â•ó‰ª∂„ÄÇËã•ÁÇ∫Â§ñÁ∂≤ÔºåÂèØËÉΩÊòØ Redmine ÈòªÊìã‰∫Ü‰ª£ÁêÜ IP„ÄÇ' 
                        };
                    }

                    setError(errorMsg);
                } finally {
                    setLoading(false);
                }
            };

            // --- Filtering Logic ---
            const filteredIssues = useMemo(() => {
                let targetIssues = issues;
                
                if (selectedUserId && selectedUserId !== 'all') {
                    targetIssues = issues.filter(i => i.assigned_to?.id == selectedUserId);
                } else if (currentUser && selectedUserId === 'me') {
                     targetIssues = issues.filter(i => i.assigned_to?.id === currentUser.id);
                }

                if (filterType === 'closed') return targetIssues.filter(i => isClosed(i.status?.name));

                let activeIssues = targetIssues.filter(i => !isClosed(i.status?.name));

                if (filterType === 'today') return activeIssues.filter(i => isToday(i.due_date));
                if (filterType === 'overdue') return activeIssues.filter(i => isPast(i.due_date));
                
                return activeIssues;
            }, [issues, filterType, selectedUserId, currentUser]);

            const counts = useMemo(() => {
                let targetIssues = issues;
                if (selectedUserId && selectedUserId !== 'all') {
                    targetIssues = issues.filter(i => i.assigned_to?.id == selectedUserId);
                } else if (currentUser && selectedUserId === 'me') {
                    targetIssues = issues.filter(i => i.assigned_to?.id === currentUser.id);
                } else if (!currentUser && issues.length === 0) {
                     return { all: 0, today: 0, overdue: 0, closed: 0 };
                }

                const active = targetIssues.filter(i => !isClosed(i.status?.name));
                return {
                    all: active.length,
                    today: active.filter(i => isToday(i.due_date)).length,
                    overdue: active.filter(i => isPast(i.due_date)).length,
                    closed: targetIssues.filter(i => isClosed(i.status?.name)).length
                };
            }, [issues, selectedUserId, currentUser]);

            const selectedUserName = useMemo(() => {
                if (!selectedUserId) return '';
                const u = availableUsers.find(u => u.id == selectedUserId);
                return u ? u.name : 'Unknown';
            }, [selectedUserId, availableUsers]);

            // --- UI Components ---
            const StatCard = ({ label, val, color, icon, active, onClick }) => (
                <div onClick={onClick} className={`bg-white p-4 rounded-xl border border-slate-100 shadow-sm cursor-pointer transition-all hover:shadow-md ${active ? 'ring-2 ring-blue-500 bg-blue-50' : ''}`}>
                    <div className="flex justify-between items-center">
                        <div>
                            <p className="text-slate-500 text-xs font-bold uppercase tracking-wider">{label}</p>
                            <p className={`text-2xl font-bold mt-1 ${color}`}>{val}</p>
                        </div>
                        <div className={`p-2 rounded-lg bg-slate-100 text-slate-400`}>
                            <Icon d={icon} className="w-5 h-5" />
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen pb-12">
                    {/* Header */}
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-20">
                        <div className="max-w-7xl mx-auto px-4 py-3">
                            <div className="flex justify-between items-center">
                                <div className="flex items-center gap-3">
                                    <div className="bg-slate-900 text-white p-2 rounded-lg">
                                        <Icon d={Icons.Activity} className="w-5 h-5" />
                                    </div>
                                    <div>
                                        <h1 className="text-lg font-bold text-slate-800">Â∞àÊ°àÊà∞ÊÉÖÂÆ§</h1>
                                        {currentUser && (
                                            <p className="text-xs text-slate-500 flex items-center gap-1">
                                                Hi, {currentUser.firstname} 
                                                <span className="bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded-full text-[10px]">
                                                    Ê™¢Ë¶ñ: {selectedUserName}
                                                </span>
                                            </p>
                                        )}
                                    </div>
                                </div>

                                <div className="flex items-center gap-2">
                                    <input 
                                        type="password" 
                                        placeholder="Ëº∏ÂÖ• Token" 
                                        className="bg-slate-50 border border-slate-200 rounded px-3 py-1.5 text-sm w-32 focus:w-48 transition-all outline-none focus:ring-2 focus:ring-blue-500"
                                        value={config.apiKey}
                                        onChange={e => setConfig({...config, apiKey: e.target.value})}
                                    />
                                    
                                    <button 
                                        onClick={fetchData} 
                                        disabled={loading}
                                        className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-1.5 rounded text-sm font-bold flex items-center gap-2 transition-colors disabled:bg-slate-400"
                                    >
                                        {loading ? <Icon d={Icons.Refresh} className="w-4 h-4 animate-spin-slow" /> : <Icon d={Icons.Search} className="w-4 h-4" />}
                                        {loading ? 'ÈÄ£Á∑ö‰∏≠...' : 'ÂàÜÊûê'}
                                    </button>

                                    <button 
                                        onClick={() => setShowSettings(!showSettings)}
                                        className={`p-2 rounded text-slate-400 hover:bg-slate-100 ${showSettings ? 'text-blue-600 bg-blue-50' : ''}`}
                                    >
                                        <Icon d={Icons.Settings} className="w-5 h-5" />
                                    </button>
                                </div>
                            </div>

                            {/* Collapsible Settings */}
                            {showSettings && (
                                <div className="mt-3 pt-3 border-t border-slate-100 flex gap-4 animate-fadeIn">
                                    <div className="flex-1">
                                        <label className="text-xs text-slate-500 block mb-1">Redmine Á∂≤ÂùÄ</label>
                                        <input 
                                            className="w-full bg-slate-50 border border-slate-200 rounded px-2 py-1 text-sm text-slate-600"
                                            value={config.url}
                                            onChange={e => setConfig({...config, url: e.target.value})}
                                        />
                                    </div>
                                    <div className="w-48">
                                        <label className="text-xs text-slate-500 block mb-1">ÈÄ£Á∑öÊ®°Âºè</label>
                                        <select 
                                            className="w-full bg-slate-50 border border-slate-200 rounded px-2 py-1 text-sm text-slate-600"
                                            value={proxyMode}
                                            onChange={e => setProxyMode(e.target.value)}
                                        >
                                            <option value="public">ÂÖ¨ÂÖ± Proxy (Êé®Ëñ¶)</option>
                                            <option value="direct">Áõ¥ÈÄ£ (ÈúÄ CORS Â•ó‰ª∂)</option>
                                        </select>
                                    </div>
                                </div>
                            )}
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto px-4 py-6 space-y-8">
                        {/* Loading Status */}
                        {loading && (
                            <div className="text-center text-blue-600 text-sm font-bold animate-pulse bg-blue-50 py-2 rounded">
                                {statusMsg}
                            </div>
                        )}

                        {error && (
                            <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-4 rounded-lg flex items-start gap-3 animate-fadeIn shadow-sm">
                                <div className="mt-1"><Icon d={Icons.Alert} className="w-5 h-5" /></div>
                                <div>
                                    <p className="font-bold text-lg">{error.title || 'ÁôºÁîüÈåØË™§'}</p>
                                    <p className="text-sm mt-1">{error.msg}</p>
                                    {error.hint && (
                                        <div className="mt-2 text-sm bg-red-100 bg-opacity-50 p-2 rounded text-red-800 flex gap-2 items-center">
                                            <Icon d={Icons.Info} className="w-4 h-4" />
                                            <span>üí° ÊèêÁ§∫Ôºö{error.hint}</span>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Main Content */}
                        {issues.length > 0 ? (
                            <section className="animate-fadeIn">
                                {/* Toolbar: User Selector */}
                                <div className="flex justify-end mb-4">
                                    <div className="flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-slate-200 shadow-sm">
                                        <Icon d={Icons.User} className="w-4 h-4 text-slate-400" />
                                        <span className="text-xs text-slate-500">Ê™¢Ë¶ñ‰∫∫Âì°:</span>
                                        <select 
                                            className="text-sm font-bold text-slate-700 outline-none bg-transparent cursor-pointer min-w-[120px]"
                                            value={selectedUserId}
                                            onChange={(e) => {
                                                setSelectedUserId(e.target.value);
                                                setFilterType('all'); 
                                            }}
                                        >
                                            {availableUsers.map(u => (
                                                <option key={u.id} value={u.id}>{u.name}</option>
                                            ))}
                                        </select>
                                    </div>
                                </div>

                                {/* Stats */}
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                    <StatCard 
                                        label={`${selectedUserName} ÁöÑÂæÖËæ¶`} 
                                        val={counts.all} 
                                        color="text-slate-800" 
                                        icon={Icons.List} 
                                        active={filterType === 'all'}
                                        onClick={() => setFilterType('all')}
                                    />
                                    <StatCard 
                                        label="‰ªäÊó•ÂæÖËæ¶" 
                                        val={counts.today} 
                                        color="text-blue-600" 
                                        icon={Icons.Clock} 
                                        active={filterType === 'today'}
                                        onClick={() => setFilterType('today')}
                                    />
                                    <StatCard 
                                        label="ÈÄæÊúüÊ°à‰ª∂" 
                                        val={counts.overdue} 
                                        color="text-red-600" 
                                        icon={Icons.Alert} 
                                        active={filterType === 'overdue'}
                                        onClick={() => setFilterType('overdue')}
                                    />
                                    <StatCard 
                                        label="Â∑≤ÁµêÊ°à" 
                                        val={counts.closed} 
                                        color="text-slate-400" 
                                        icon={Icons.CheckCircle} 
                                        active={filterType === 'closed'}
                                        onClick={() => setFilterType('closed')}
                                    />
                                </div>

                                {/* List */}
                                <div className="bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                                    <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                                        <h3 className="font-bold text-slate-700 flex items-center gap-2">
                                            {filterType === 'all' ? 'ÂæÖËæ¶Ê°à‰ª∂ÂàóË°®' : 
                                             filterType === 'today' ? '‰ªäÊó•Âà∞ÊúüÊ°à‰ª∂' : 
                                             filterType === 'overdue' ? 'ÈÄæÊúüÊ°à‰ª∂ÂàóË°®' : 
                                             'Â∑≤ÁµêÊ°àÊ≠∑Âè≤Á¥ÄÈåÑ'}
                                            <span className="text-xs font-normal text-slate-400 bg-slate-100 px-2 py-0.5 rounded-full">
                                                {selectedUserName}
                                            </span>
                                        </h3>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm text-left">
                                            <thead className="bg-slate-50 text-slate-500 uppercase text-xs">
                                                <tr>
                                                    <th className="px-6 py-3">#</th>
                                                    <th className="px-6 py-3">È©óË≠â</th>
                                                    <th className="px-6 py-3 w-1/3">‰∏ªÈ°å</th>
                                                    <th className="px-6 py-3">Ë¢´ÂàÜÊ¥æËÄÖ</th>
                                                    <th className="px-6 py-3">ÊúüÈôê</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-100">
                                                {filteredIssues.map(issue => {
                                                    const isOverdue = isPast(issue.due_date) && !isClosed(issue.status?.name);
                                                    return (
                                                        <tr key={issue.id} className="hover:bg-slate-50 transition-colors">
                                                            <td className="px-6 py-4 font-mono text-blue-600 font-bold">
                                                                <a href={`${config.url}/issues/${issue.id}`} target="_blank" className="hover:underline">#{issue.id}</a>
                                                            </td>
                                                            <td className="px-6 py-4">
                                                                <span className={`px-2 py-1 rounded text-xs font-bold ${getStatusColor(issue.status.name)}`}>
                                                                    {issue.status.name}
                                                                </span>
                                                            </td>
                                                            <td className="px-6 py-4 font-medium text-slate-700">
                                                                <div className="text-xs text-slate-400 mb-0.5">{issue.project?.name}</div>
                                                                {issue.subject}
                                                            </td>
                                                            <td className="px-6 py-4">
                                                                <div className="flex items-center gap-2">
                                                                    <div className="w-6 h-6 rounded-full bg-slate-200 flex items-center justify-center text-[10px] font-bold text-slate-600">
                                                                        {issue.assigned_to?.name.charAt(0)}
                                                                    </div>
                                                                    <span className="text-slate-600">{issue.assigned_to?.name}</span>
                                                                </div>
                                                            </td>
                                                            <td className={`px-6 py-4 ${isOverdue ? 'text-red-600 font-bold' : 'text-slate-500'}`}>
                                                                {issue.due_date || '-'}
                                                            </td>
                                                        </tr>
                                                    );
                                                })}
                                            </tbody>
                                        </table>
                                        {filteredIssues.length === 0 && (
                                            <div className="p-8 text-center text-slate-400">
                                                {currentUser ? `Ê≤íÊúâÁ¨¶ÂêàÊ¢ù‰ª∂ÁöÑÊ°à‰ª∂ (${selectedUserName})` : 'Ë´ãÂÖàÁôªÂÖ•'}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </section>
                        ) : (
                            // Welcome / Empty State
                            !loading && !error && (
                                <div className="flex flex-col items-center justify-center py-20 text-center animate-fadeIn">
                                    <div className="bg-white p-4 rounded-full shadow-sm mb-6">
                                        <Icon d={Icons.Activity} className="w-12 h-12 text-slate-300" />
                                    </div>
                                    <h2 className="text-xl font-bold text-slate-700 mb-2">Ê∫ñÂÇôÈñãÂßãÂ∑•‰Ωú</h2>
                                    <p className="text-slate-500 max-w-md mb-8">
                                        Ë´ãÂú®‰∏äÊñπËº∏ÂÖ•ÊÇ®ÁöÑ Redmine API Token Âç≥ÂèØÂèñÂæóË≥áÊñô„ÄÇ
                                    </p>
                                </div>
                            )
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Main />);
    </script>
</body>
</html>